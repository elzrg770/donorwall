<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Donor Wall – Fan Layout</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    body {
      margin:0;
      padding:2rem 1rem;
      font-family: sans-serif;
      background:#0e1b2c;
      color:#fff;
      text-align:center;
    }
    h1 {
      margin-bottom:3rem;
      font-size:2.4rem;
    }
    #donor-wall {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:22px;
      max-width:1100px;
      margin:0 auto;
    }
    .tier-row {
      display:flex;
      justify-content:center;
      gap:18px;
      flex-wrap:nowrap;
    }
    .plaque {
      width:120px;
      height:60px;
      border-radius:50%/50%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-weight:600;
      font-size:0.95rem;
      box-shadow:0 0 6px rgba(0,0,0,.4);
      padding:4px;
      text-align:center;
    }
    .plaque span.amount {
      font-size:0.75em;
      font-style:italic;
      font-weight:400;
      /* hidden by your rule in style.css, kept for structure */
    }
    .top {
      background:linear-gradient(#ffd700,#ffc20e);
      color:#000;
    }
    .middle {
      background:linear-gradient(#f1f1f1,#bfc7d1);
      color:#000;
    }
    .bottom {
      background:linear-gradient(#ef8f39,#e6945e);
      color:#000;
    }

    /* Hide donor amounts and tier headings */
    .plaque .amount { display: none !important; }
    #donor-wall h2 { display: none !important; }

    /* hover states (unchanged) */
    .plaque.bottom:hover { background:linear-gradient(#e3730e,#c48256); color:#fff; }
    .plaque.middle:hover { background:linear-gradient(#979393,#b7bec7); color:#fff; }
    .plaque.top:hover    { background:linear-gradient(#c2a60c,#e2aa05); color:#fff; }
  </style>
</head>

<body>
  <h1>Chai Club Members</h1>
  <div id="donor-wall">Loading donors…</div>

  <script>
    // 1) CSV URL and fallback
    const CSV_FILE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSgtQMdzrtymc-gPKeDZET-ynYo_DDCL-icYNJ7EGOWP-TjhRXiAUUhmvjvNN7P7_L9kjC4QbNcTd-f/pub?gid=0&single=true&output=csv";
    let dynamicLogo = 'club.png';

    // 2) fetch and parse
    async function fetchDonors(url) {
      const res = await fetch(url);
      const txt = await res.text();
      const [hdr, ...rows] = txt.trim().split('\n');
      const cols = hdr.split(',').map(h=>h.trim().toLowerCase());
      const iName = cols.indexOf('name'),
            iAmt  = cols.indexOf('amount'),
            iTier = cols.indexOf('tier'),
            iLogo = cols.indexOf('logo');
      return rows.map(r => {
        const c = r.split(',');
        const name   = c[iName]?.trim();
        const amount = +c[iAmt] || 0;
        const tier   = c[iTier]?.trim().toLowerCase();
        const logo   = c[iLogo]?.trim();
        if (logo && dynamicLogo === 'club.png') {
          dynamicLogo = logo.replace(/dl=0$/, 'raw=1');
        }
        return { name, amount, tier };
      }).filter(d=>d.name && d.tier);
    }

    // 3) helper to split uneven rows for Gold/Bronze
    const TIERS = {
      top:    { rows:[3,4,5,6,7] },
      middle: { rows:[4,5,6,5,4] },
      bottom: { rows:[9,8,7,6,5,4] }
    };
    function distribute(list, key) {
      const pat = TIERS[key].rows;
      const out = pat.map(()=>[]);
      let idx = 0;
      list.forEach(d => {
        while(idx < out.length && out[idx].length >= pat[idx]) idx++;
        (out[idx]||out[out.length-1]).push(d);
      });
      return out;
    }

    // 4) create one plaque
    function createPlaque(d) {
      const div = document.createElement('div');
      div.className = 'plaque ' + d.tier;
      div.innerHTML = `
        ${d.name}
        <span class="amount">${d.amount.toLocaleString()}</span>
      `;
      return div;
    }

    // 5) render exactly your original layout + dynamic center-logo
    function render(donors) {
      const wall = document.getElementById('donor-wall');
      wall.innerHTML = '';
      ['top','middle','bottom'].forEach(tier => {
        const group = donors.filter(d=>d.tier===tier);
        const rows = distribute(group,tier);

        if (tier === 'middle') {
          // two columns + center logo
          const wrap = document.createElement('div');
          wrap.className = 'middle-tier-wrap';

          // left/right
          const left = document.createElement('div');
          const right= document.createElement('div');
          [left,right].forEach(col=>{
            col.style.display='flex';
            col.style.flexDirection='column';
            col.style.gap='18px';
          });

          const half = Math.ceil(group.length/2);
          group.slice(0,half).forEach(d=>left.appendChild(createPlaque(d)));
          group.slice(half).forEach(d=>right.appendChild(createPlaque(d)));

          wrap.appendChild(left);
          // dynamic center logo
          const img = document.createElement('img');
          img.src = dynamicLogo;
          img.alt= 'Center Logo';
          img.style.width='300px';
          img.style.height='300px';
          img.style.flexShrink='0';
          wrap.appendChild(img);
          wrap.appendChild(right);

          wall.appendChild(wrap);

        } else {
          // simple rows
          rows.forEach(rlist=>{
            const row = document.createElement('div');
            row.className='tier-row';
            rlist.forEach(d=>row.appendChild(createPlaque(d)));
            wall.appendChild(row);
          });
        }
      });
    }

    // 6) kick it off
    fetchDonors(CSV_FILE)
      .then(arr=>render(arr))
      .catch(e=>{
        console.error(e);
        document.getElementById('donor-wall').textContent='Error loading data.';
      });
  </script>
</body>
</html>
